#include "s21_math.h"

double s21_fma(double a, double b, double c) {
  return a * b + c;
}

double s21_atan (double x)
{
    double a, z, p, r, q, s, t;

    z = s21_fabs (x);
    a = (z > 1.0) ? (1.0 / z) : z;
    s = a * a;
    q = s * s;

    p =            -2.0258553044340116e-5;
    t =             2.2302240345710764e-4;
    p = s21_fma (p, q, -1.1640717779912220e-3);
    t = s21_fma (t, q,  3.8559749383656407e-3);
    p = s21_fma (p, q, -9.1845592187222193e-3);
    t = s21_fma (t, q,  1.6978035834594660e-2);
    p = s21_fma (p, q, -2.5826796814492296e-2);
    t = s21_fma (t, q,  3.4067811082715810e-2);
    p = s21_fma (p, q, -4.0926382420509999e-2);
    t = s21_fma (t, q,  4.6739496199158334e-2);
    p = s21_fma (p, q, -5.2392330054601366e-2);
    t = s21_fma (t, q,  5.8773077721790683e-2);
    p = s21_fma (p, q, -6.6658603633512892e-2);
    t = s21_fma (t, q,  7.6922129305867892e-2);
    p = s21_fma (p, s, t);
    p = s21_fma (p, s, -9.0909012354005267e-2);
    p = s21_fma (p, s,  1.1111110678749421e-1);
    p = s21_fma (p, s, -1.4285714271334810e-1);
    p = s21_fma (p, s,  1.9999999999755005e-1);
    p = s21_fma (p, s, -3.3333333333331838e-1);
    p = s21_fma (p * s, a, a);

    r = (z > 1.0) ? s21_fma (0.93282184640716537, 1.6839188885261840, -p) : p;
    return s21_copysign (r, x);
}